# ポート設定ガイド

KAISHUプロジェクトでは、開発環境でのポート競合を避けるため、柔軟なポート設定が可能です。

## デフォルトポート

- 開発サーバー: `3000`
- E2Eテスト: 開発サーバーと同じポート

## カスタムポートの設定方法

### 1. 環境変数を使用する方法

```bash
# 開発サーバーをポート3001で起動
PORT=3001 npm run dev

# E2Eテストをポート3002で実行
PORT=3002 npm run test:e2e
```

### 2. .envファイルを使用する方法

`.env.local`ファイルを作成し、以下を設定：

```env
# 開発サーバーのポート
PORT=3001
```

### 3. 自動ポート検出

CI/CDローカルチェック（`npm run ci:local`）実行時：

- ポート3000が使用中の場合、自動的に3001〜4000の範囲で利用可能なポートを探します
- E2Eテストは見つかったポートで自動的に実行されます

### 4. 代替E2Eテストコマンド

ポート3000が使用できない場合：

```bash
# 自動的に利用可能なポートを見つけてE2Eテストを実行
npm run test:e2e:alt
```

## Playwrightの設定

`playwright.config.ts`は環境変数`PORT`を自動的に認識します：

```typescript
const port = process.env.PORT || '3000';
const baseURL = `http://localhost:${port}`;
```

## トラブルシューティング

### ポート競合エラーが発生する場合

1. 使用中のポートを確認

   ```bash
   lsof -i :3000
   ```

2. プロセスを停止

   ```bash
   kill -9 <PID>
   ```

3. 別のポートで起動
   ```bash
   PORT=3001 npm run dev
   ```

### E2Eテストが接続できない場合

1. 開発サーバーが起動しているか確認
2. 正しいポートを指定しているか確認
3. `npm run test:e2e:alt`を使用して自動ポート検出を利用

## GitHub Actions環境

CI/CD環境では常にポート3000が使用されます。ローカル環境とは異なり、ポート競合の心配はありません。
