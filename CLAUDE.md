# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

KAISHU (ALMS - AI Life Management System) - AIを活用した統合的なライフマネジメントシステム。ユーザーの人生の目標達成を支援するために、LLMによる動的なタスク生成とタイムブロック管理を統合したアプリケーション。

## 基本方針

- ユーザの指示に従って正確に作業を実行する
- 不明な点は必ずユーザに確認する
- 作業の進捗と結果を明確に報告する
- プロジェクトの一貫性を保持する

## コミュニケーションガイドライン

### 情報収集と回答
- 技術的質問にはcontext7を使って最新の情報を調べてから回答してください

### 作業記録管理
- ユーザと議論して決定した内容はルートディレクトリに `.dev/contexts` ディレクトリを作成してその中にmdファイルとして記録してください

### GitHub運用ルール
- GitHubのissueのクローズはユーザに依頼されない限り禁止です
- 作業の途中で必要になった場合はユーザに依頼してください

### プロジェクトファイルの参照ルール
- `contexts`ディレクトリには作業に必要な情報が入っているので常に参照してください
- `plans`ディレクトリにはプロジェクトの情報が入っていますが、必ずしも作業に必要ではないので、ユーザの指示があった場合に参照してください

### 実装変更時の承認ルール
- `contexts`ディレクトリ内のファイルに定義されている内容と違う実装を行う場合は必ずユーザの承認を得てください
- ユーザの指示で`contexts`内のファイルに定義されている内容と違う実装を行う場合は、作業後に`contexts`内の該当ファイルを更新してください
- その場合に`plans`内のファイルにも影響がないか確認して、影響があれば`plans`内のファイルも更新してください

### UI実装の確認
- UIを実装する場合は、playwrightを使って視覚的に実装内容の確認を行ってください

## コーディングガイドライン

### コード品質と組織化
- 小さく焦点を絞ったコンポーネントを作成する（50行未満）
- 確立されたプロジェクト構造に従う
- デフォルトでレスポンシブデザインを実装する
- デバッグ用の詳細なコンソールログを記述する

### コンポーネント作成
- 各コンポーネントに対して新しいファイルを作成する
- 可能な限りshadcn/uiコンポーネントを使用する
- アトミックデザインの原則に従う
- 適切なファイル組織を確保する

### 状態管理
- サーバー状態にはReact Queryを使用する
- ローカル状態はuseState/useContextで実装する
- プロップドリリングを避ける
- 適切な場合はレスポンスをキャッシュする

### エラーハンドリング
- ユーザーフィードバックにはトースト通知を使用する
- 適切なエラーバウンダリを実装する
- デバッグ用にエラーをログ出力する
- ユーザーフレンドリーなエラーメッセージを提供する

### パフォーマンス
- 必要に応じてコード分割を実装する
- 画像読み込みを最適化する
- 適切なReactフックを使用する
- 不要な再レンダリングを最小化する

### セキュリティ
- すべてのユーザー入力を検証する
- 適切な認証フローを実装する
- 表示前にデータをサニタイズする
- OWASPセキュリティガイドラインに従う

### テスト
- 重要な機能に対してユニットテストを記述する
- 統合テストを実装する
- レスポンシブレイアウトをテストする
- エラーハンドリングを検証する

### ドキュメント
- 複雑な機能にドキュメントを作成する
- READMEを最新の状態に保つ
- セットアップ手順を含める
- APIエンドポイントをドキュメント化する

### コーディングベストプラクティス

#### コメントの方針
- ユーザーから要求されない限り、または複雑で追加のコンテキストが必要な場合を除き、記述するコードにコメントを追加しない

#### コードスタイルの一貫性
- ファイルを変更する際は、まずそのファイルのコード規約を理解する
- コードスタイルを模倣し、既存のライブラリとユーティリティを使用し、既存のパターンに従う

#### ライブラリの確認
- 有名なライブラリでも、それが利用可能であると仮定しない
- ライブラリやフレームワークを使用するコードを記述する際は、まずこのコードベースが既にそのライブラリを使用していることを確認する
- 近隣のファイルを確認するか、package.json（言語に応じてcargo.tomlなど）をチェックする

#### 新規コンポーネント作成
- 新しいコンポーネントを作成する際は、まず既存のコンポーネントを確認してその記述方法を理解する
- フレームワークの選択、命名規約、型付け、その他の規約を検討する

#### コード編集時の考慮事項
- コードの一部を編集する際は、まずそのコードの周辺コンテキスト（特にインポート）を確認して、コードのフレームワークとライブラリの選択を理解する
- 最も慣用的な方法で変更を行う方法を検討する

## 開発コマンド

```bash
npm install        # 依存関係のインストール
npm run dev        # 開発サーバー起動 (http://localhost:8080)
npm run build      # プロダクションビルド
npm run build:dev  # 開発モードビルド
npm run lint       # ESLintの実行
npm run preview    # ビルドのプレビュー
```

**注意:** テストスクリプトは現在未設定（v0.0.2プロトタイプフェーズ）

## アーキテクチャ概要

### コアコンセプト
- **階層的目標管理:** Life Goals → Goal Conditions → Projects → Milestones → Tasks/Habits
- **LLMベースのタスク生成:** 各タイムブロック開始時にAIがリアルタイムでタスクを生成
- **動的スケジュール調整:** ユーザーの進捗に応じてAIがスケジュールを最適化

### テクノロジースタック
- **フレームワーク:** Vite + React 18.3 + TypeScript 5.5
- **UI:** shadcn/ui (Radix UI) + Tailwind CSS
- **状態管理:** Zustand 5.0 (永続化付き)
- **ルーティング:** React Router DOM 6.26
- **APIクライアント:** TanStack Query 5.56
- **フォーム:** React Hook Form + Zod
- **LLM統合:** OpenAI GPT-4o予定 (LangChain使用予定)

### コード構造
```
src/
├── components/         # 機能別UIコンポーネント
│   ├── dashboard/     # ダッシュボード（メインビュー）
│   ├── calendar/      # カレンダービュー
│   ├── projects/      # プロジェクト管理
│   ├── tasks/         # タスク管理
│   ├── habits/        # 習慣トラッキング
│   ├── layout/        # レイアウト（サイドバー等）
│   └── ui/            # shadcn/uiコンポーネント群
├── lib/
│   ├── store.ts       # Zustand中央状態管理
│   └── utils.ts       # ユーティリティ関数
├── types/             # TypeScript型定義（全エンティティ）
└── hooks/             # カスタムReactフック
```

### 状態管理アーキテクチャ
- **中央ストア:** Zustandで永続化された単一ストア
- **スライス構成:**
  - userPreferences: ユーザー設定
  - lifeGoals: 人生の目標
  - projects: プロジェクト管理
  - timeBlocks: タイムブロック
  - tasks: タスク管理
  - conversations: LLM会話履歴
  - UI状態: チャット開閉、現在のビュー等

### 現在の実装状況
**実装済み:**
- 基本的なアプリケーション構造とルーティング
- Zustandベースの状態管理（ローカルストレージ永続化）
- 全主要エンティティの型定義
- 基本的なUIビュー（Dashboard、Projects、Tasks、Habits、Calendar）
- フローティングLLMチャットコンポーネント（UIのみ）

**未実装（v0.1.0で予定）:**
- LLM統合（OpenAI/LangChain）
- Google Calendar同期
- バックエンドAPI
- 認証システム
- データベース永続化

### 重要な注意事項
- 必ず`contexts`ディレクトリの内容を参照して作業を進めること（PRD、バージョン計画等）
- `plans`ディレクトリは必要時のみ参照
- UIの変更時は必ずレスポンシブデザインを考慮すること
- 新しい機能を実装する前に既存のコードパターンを確認すること
- TypeScriptは意図的に緩い設定（高速プロトタイピングのため）